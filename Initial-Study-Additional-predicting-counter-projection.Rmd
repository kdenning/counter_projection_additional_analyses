---
title: "Initial study - Additional Analyses"
author: "Kathryn Denning"
date: "6/18/2020"
output: 
  html_document:
    code_folding: "hide"
    toc: true
    toc_float: true
    dev: png
  pdf_document:
    dev: cairo_pdf
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
---
```{r set-up, include = FALSE}
#loading packages
library(foreign)
library(reshape2)
library(tidyverse)
library(dplyr)
library(car)
library(haven)
library(psych)
library(lmerTest)
library(sjPlot)
library(reshape2)
library(data.table)
library(emmeans)
library(effects)
library(Cairo)
library(tinytex)
library(rio)
library(magrittr)

#making it round to three decimal places
options(scipen = 999)
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

knitr::opts_knit$set(dev.args = list(type = "cairo"))

trace(grDevices:::png, quote({
  if (missing(type) && missing(antialias)) {
    type <- "cairo-png"
    antialias <- "subpixel"
  }
}), print = FALSE)
```

```{r data import and cleaning initial study, include = FALSE}
#importing data with IP address and lat/long to look for MTurk bots
bot_check <- Import("ppt1_with lat long to check bots.csv") 

bot_check <- bot_check[-c(1,2),,drop = F] 

#importing the data that has been reviewed for completion of PT task
wide_data <- Import("ppt1_fulldata_ptcleanedonly.xlsx") 

#dropping the longer description of each question
wide_dropped1 <- wide_data[-c(1),,drop = F] 

#removing repeat IP addresses since those often indicate bots
#getting a dataset with only subid and IPAdress
ip <- bot_check %>% 
  select(subid, IPAddress)

#identifying the repeat IP addresses
repeat_ips <- ip$IPAddress[duplicated(ip$IPAddress)]

#getting the corresponding subids
bot_check %>% 
  select(subid, IPAddress, LocationLatitude, LocationLongitude) %>% 
  filter(IPAddress %in% c("24.241.223.182", "72.79.119.56", "108.230.124.237", "172.97.7.163", "67.236.228.7", "68.190.36.43"))

#removing the subids from the overall dataset that has already been cleaned to remove people who did not correctly complete the PT narrative task
no_bots <- wide_data %>% 
  filter(!subid %in% c(96, 99, 166, 167, 171, 239, 265, 345, 613, 758, 778, 779))

no_bots <- no_bots[-c(1), ] 

#Data cleaning
clean_data <- clean_data <- no_bots %>% 
  ## drop two MFQ items that aren't actually the survey - 6, 22 in each
select(-MFQSelf_6, -MFQSelf_22, -MFQTrump_6, -MFQTrump_22, -MFQClin_6,
       -MFQClin_22, -MFQTarg_6, -MFQTarg_22) %>% 
  ## dropping PANAS and exploratory items for this study to make data more manageable
  select(-c(PANAS1_1:PANAS1_20, PANAS2_1:PANAS2_20, 
            gender_writein, race_writein, birth_writein, race_writein, 
            language_writein, raise_writein)) %>% 
  ### Wrangling data to get MFQ for self, MFQ to targ, MFQ for stereotype, column for candidate, average of IG identification
  pivot_longer(c(MFQSelf_1:MFQSelf_32,
                 MFQTrump_1:MFQTrump_32,
                 MFQClin_1:MFQClin_32,
                 MFQTarg_1:MFQTarg_32),
               names_sep = "_",
               names_to = c("mfq_type", "MFQ_Number")) %>% 
  pivot_wider(names_from = mfq_type, values_from = value) %>% 
  pivot_longer(IG_Clin_1:IG_Trump_14,
               names_sep = "_",
               names_to = c("ident", "ident_targ", "ident_num")) %>% 
  pivot_wider(names_from = ident, values_from = value) %>% 
  rename(ident = IG) %>% 
  filter(!is.na(ident)) %>% 
  #making candidate they voted for a factor
  mutate(Cand_votedfor = ifelse(ident_targ == "Clin", 1, 
                                ifelse(ident_targ == "Trump", 0, NA))) %>% 
  pivot_longer(Day_Clin_In_PT:Day_Trump_In_C,
               names_to = c("Day_key")) %>% 
  rename(Day_content = value) %>% 
  mutate(Day_key = as.factor(Day_key)) %>% 
  filter(!is.na(Day_content)) %>% 
  mutate(inoutgroup = fct_collapse(Day_key, 
                                   Ingroup = c("Day_Clin_In_C", 
                                                "Day_Clin_In_PT", 
                                                "Day_Trump_In_C", 
                                                "Day_Trump_In_PT"), 
                                   Outgroup = c("Day_Clin_Out_C", 
                                                "Day_Clin_Out_PT",
                                                "Day_Trump_Out_C", 
                                                "Day_Trump_Out_PT")),
         PT = fct_collapse(Day_key,
                           PT = c("Day_Clin_In_PT",
                                  "Day_Trump_In_PT",
                                  "Day_Clin_Out_PT",
                                  "Day_Trump_Out_PT"),
                           control = c("Day_Clin_In_C",
                                       "Day_Trump_In_C",
                                       "Day_Clin_Out_C",
                                       "Day_Trump_Out_C")),
         par_cand = fct_collapse(Day_key,
                                  Clinton = c("Day_Clin_In_PT",
                                           "Day_Clin_Out_PT",
                                           "Day_Clin_In_C",
                                           "Day_Clin_Out_C"),
                                  Trump = c("Day_Trump_In_PT",
                                            "Day_Trump_Out_PT",
                                            "Day_Trump_In_C",
                                            "Day_Trump_Out_C")),
         targ_cand = fct_collapse(Day_key,
                                  Clinton = c("Day_Clin_In_PT",
                                              "Day_Clin_In_C",
                                              "Day_Trump_Out_PT",
                                              "Day_Trump_Out_C"),
                                  Trump = c("Day_Clin_Out_PT",
                                            "Day_Clin_Out_C",
                                            "Day_Trump_In_PT",
                                            "Day_Trump_In_C")))

clean_data[,1:31] <- sapply(clean_data[,1:31],as.numeric)
clean_data[,33:35] <- sapply(clean_data[,33:35],as.numeric)

  #average of ingroup-identification for each subjut
clean_data2 <- clean_data %>% 
  #effects coding for group with ingroup = .5 and outgorup = -.5, for PT .5 = PT and Control = -.5
  mutate(inoutgroup_effects = ifelse(inoutgroup == "Ingroup", .5,
                                     ifelse(inoutgroup == "Outgroup", -.5, NA)),
         PT_effects = ifelse(PT == "PT", .5, 
                             ifelse(PT == "control", -.5, NA)),
         targ_cand = ifelse(targ_cand == "Clinton", 1, 
                            ifelse(targ_cand == "Trump", 2, NA)),
         MFQStereo = ifelse(targ_cand == 1, MFQClin, 
                            ifelse(targ_cand == 2, MFQTrump, NA))) %>% 
  #grand mean centering MFQ for self
  mutate(MFQSelf_c = MFQSelf - mean(MFQSelf, na.rm = TRUE),
         MFQStereo_c = MFQStereo - mean(MFQStereo, na.rm = TRUE)) %>%  
  #removing people who failed the manipulation check
  filter(targ_cand == 1 & Man_TargVote == 1 | 
           targ_cand == 2 & Man_TargVote == 2) %>%
  select(-Day_content, -Day_key) %>% 
  #effects coding candidate
  mutate(Targ_Cand_effectscoded = ifelse(targ_cand == "1", .5, 
                                         ifelse(targ_cand == "2", -.5, NA))) %>% 
  group_by(subid) %>% 
  mutate(ident_subave = mean(ident)) %>% 
  filter(!is.na(ident_subave))

#for some reason, this wouldn't work in the piping above, so had to hard code it
#grand mean centering for ingroup identification
clean_data2$ident_c <- clean_data2$ident_subave - mean(clean_data2$ident_subave, na.rm = TRUE)
clean_data2$Gender <- as.factor(clean_data2$Gender)
levels(clean_data2$Gender) <- c("Male", "Female", "Other")
clean_data2$Race <- as.factor(clean_data2$Race)
levels(clean_data2$Race) <- c("American Indian/Native Alaskan", 
                             "Asian", 
                             "Black",
                             "Latinx",
                             "Middle Eastern",
                             "Caucasian",
                             "Multiracial",
                             "Other")

#data with just the variables for the analysis
stereo_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, Man_PT, par_cand, MFQStereo) %>%
  unique() %>% 
  na.omit()
```

# Stereotype moderator analysis {.tabset .tabset-fade .tabset-pills}

## Results

```{r stereo analysis}
#model
projmodel_stereo <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = stereo_analysis)

#results
tab_model(projmodel_stereo,
          title = "Projection moderated by stereotyping")

#confidence intervals for ones that rounding to two in tab_model isn't enough info
confint(projmodel_stereo)
```

## Plot: Projection by stereo x ident

```{r int proj, stereo, and ident set-up}
describe(stereo_analysis$MFQStereo_c)
describe(stereo_analysis$ident_c)

proj_stereo_effects <- effect(term = "MFQSelf_c:MFQStereo_c:ident_c", 
                           xlevels = list(ident_c = c(-1.8, 0, 1.8), 
                                         MFQStereo_c = c(-1.67, 0, 1.67)), 
                           mod = projmodel_stereo)

proj_stereo_int <- as.data.frame(proj_stereo_effects)

proj_stereo_int$Stereotyping <- as.factor(proj_stereo_int$MFQStereo_c)
proj_stereo_int$Identification <- as.factor(proj_stereo_int$ident_c)

ident_label <- c("-1.8" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.8" = "High identificatiion \n (1 SD above)")

stereo_label <- c("-1.67" = "Low stereotyping \n (1 SD below)",
                  "0" = "Average stereotyping",
                  "1.67" = "High stereotyping \n (1 SD above)")
```

```{r proj stereo ident plot}
ggplot(proj_stereo_int, aes(MFQSelf_c, 
                             fit, 
                             group = Identification, 
                             color = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Identification)) +
  facet_wrap(~Stereotyping, labeller = 
               labeller(Stereotyping = stereo_label)) +
  scale_linetype_manual("Identification", breaks = c(-1.8, 0, 1.8), 
                       labels = c("Low (1 SD below)", 
                                  "Average",
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "dashed",
                                  "dotted")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Plot: Projection by stereo x group

```{r int proj, stereo, and targ set-up}
proj_stereo_targME_effects <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects", 
                           xlevels = list(inoutgroup_effects = c(-.5, .5), 
                                         MFQStereo_c = c(-1.67, 0, 1.67)), 
                           mod = projmodel_stereo)

proj_stereo_targME_effects<- as.data.frame(proj_stereo_targME_effects)

proj_stereo_targME_effects$Stereotyping <- as.factor(proj_stereo_targME_effects$MFQStereo_c)
proj_stereo_targME_effects$Group <- as.factor(proj_stereo_targME_effects$inoutgroup_effects)

stereo_label <- c("-1.67" = "Low stereotyping \n (1 SD below)",
                  "0" = "Average stereotyping",
                  "1.67" = "High stereotyping \n (1 SD above)")
```

```{r proj stereo group plot}
# ggpreview <- function(...) {
#   fname <- tempfile(fileext = ".png")
#   ggsave(filename = fname, ...)
#   system2("open", fname)
#   invisible(NULL)
# }

knitr::opts_chunk$set(fig.width = 8, fig.height = 6) 

ggplot(proj_stereo_targME_effects, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Stereotyping, labeller = 
               labeller(Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-0.5, 0.5), 
                       labels = c("Out-group", 
                                  "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by target group and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

# ggpreview(width = 8, height = 6, units = "in")
```

## Plot: Projection by group x ident

```{r three-way stereo set-up}
initial_study_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.8, 0, 1.8), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = projmodel_stereo)

initial_study_3way <- as.data.frame(initial_study_3way)

initial_study_3way$Group <- as.factor(initial_study_3way$inoutgroup_effects)
initial_study_3way$Identification <- as.factor(initial_study_3way$ident_c)
```

```{r three-way plot BW}
# ggpreview <- function(...) {
#   fname <- tempfile(fileext = ".png")
#   ggsave(filename = fname, ...)
#   system2("open", fname)
#   invisible(NULL)
# }

knitr::opts_chunk$set(fig.width = 8, fig.height = 6) 

ggplot(initial_study_3way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and group membership",
       subtitle = "Controlled for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

# ggpreview(width = 8, height = 6, units = "in")
```

## Plot: Projection by group

```{r main effect group plot set-up, include = FALSE}
initial_study_main_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = projmodel_stereo)

initial_study_main_group <- as.data.frame(initial_study_main_group)

initial_study_main_group$Group <- as.factor(initial_study_main_group$inoutgroup_effects)
```

```{r main effect group plot BW}
# ggpreview <- function(...) {
#   fname <- tempfile(fileext = ".png")
#   ggsave(filename = fname, ...)
#   system2("open", fname)
#   invisible(NULL)
# }

knitr::opts_chunk$set(fig.width = 8, fig.height = 6) 

ggplot(initial_study_main_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlled for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

# ggpreview(width = 8, height = 6, units = "in")
```

These results demonstrate that our significant three-way interaction from before is no longer significant, but the main effect of group identification still is significant and still shows counter projection. The three-way is not significant because, regardless of in-group identification, people are still counter projecting to the same extent with their out-group and projecting normally with their in-group.

## Plot: Projection by stereo x ident x group

```{r int proj, stereo, group, and ident set-up}
proj_stereo_4way <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.8, 0, 1.8), 
                                         MFQStereo_c = c(-1.67, 0, 1.67),
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = projmodel_stereo)

proj_stereo_4way <- as.data.frame(proj_stereo_4way)

group_label <- c()

proj_stereo_4way %<>% 
  mutate(Identification = as.factor(ident_c),
         Stereotyping = as.factor(MFQStereo_c),
         TargetGroup = as.factor(inoutgroup_effects)) %>% 
  mutate(TargetGroup = dplyr::recode(TargetGroup,
                                     `-0.5` = "Out-group",
                                     `0.5` = "In-group"))
```

```{r int proj, stereo, group, and ident plot}
# ggpreview <- function(...) {
#   fname <- tempfile(fileext = ".png")
#   ggsave(filename = fname, ...)
#   system2("open", fname)
#   invisible(NULL)
# }

knitr::opts_chunk$set(fig.width = 8, fig.height = 6) 

ggplot(proj_stereo_4way, aes(MFQSelf_c, 
                             fit, 
                             group = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Identification)) +
  facet_grid(vars(TargetGroup), vars(Stereotyping),
             labeller = labeller(Stereotyping = stereo_label)) +
  scale_linetype_manual("Identification", breaks = c(-1.8, 0, 1.8), 
                       labels = c("Low (1 SD below)", 
                                  "Average",
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "dashed",
                                  "dotted")) +
  theme_minimal() +
  labs(title = "Projection predicted by identification, target group, and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

# ggpreview(width = 8, height = 6, units = "in")
```

# Subset analyses {.tabset .tabset-fade .tabset-pills}

## Subgroups of target group

### Out-group

```{r outgroup sig from zero}
out_only <- stereo_analysis %>% filter(inoutgroup_effects != .5)

projmodel_stereo_out <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = out_only)


tab_model(projmodel_stereo_out,
          title = "Projection moderated by stereotyping with out-group data only")
```

This analysis was run using only data for the out-group, meaning the main effect of MFQSelf_c now represents the effect of projection for out-group targets only. The effect is not significant, meaning, in the plot with the whole data looking at the main effect of target group (above), that the out-group effect is not different from 0. 

### In-group 

```{r ingroup sig from zero}
in_only <- stereo_analysis %>% filter(inoutgroup_effects == .5)

projmodel_stereo_in <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = in_only)


tab_model(projmodel_stereo_in,
          title = "Projection moderated by stereotyping with in-group data only")
```

## Subsets of candidate support

### Clinton

```{r Clinton only sig from zero}
clinton_only <- stereo_analysis %>% filter(par_cand == "Clinton")

projmodel_stereo_clinton <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = clinton_only)


tab_model(projmodel_stereo_clinton,
          title = "Projection moderated by stereotyping with Clinton supporter data only")
```

### Trump

```{r Trump only sig from zero}
trump_only <- stereo_analysis %>% filter(par_cand == "Trump")

projmodel_stereo_trump <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = trump_only)


tab_model(projmodel_stereo_trump,
          title = "Projection moderated by stereotyping with Trump supporter data only")
```

# Candidate moderator analysis {.tabset .tabset-fade .tabset-pills}

## Results

```{r cand only analysis}
#model
projmodel_cand <- lmer(MFQTarg ~ MFQSelf_c * par_cand *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = stereo_analysis)

#results
tab_model(projmodel_cand,
          title = "Projection moderated by candidate")

#confidence intervals for ones that rounding to two in tab_model isn't enough info
confint(projmodel_cand)
```

## Plot: Projection by candidate support x group

```{r three-way cand only set-up}
initial_study_3way_cand <- effect(term = "MFQSelf_c:par_cand:inoutgroup_effects", 
                           xlevels = list(inoutgroup_effects = c(-.5, .5), 
                                         par_cand = c("Clinton", "Trump")), 
                           mod = projmodel_cand)

initial_study_3way_cand <- as.data.frame(initial_study_3way_cand)

initial_study_3way_cand$Group <- as.factor(initial_study_3way_cand$inoutgroup_effects)
initial_study_3way_cand$Candidate <- as.factor(initial_study_3way_cand$par_cand)
```

```{r three-way plot cand BW}
ggplot(initial_study_3way_cand, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Candidate) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by candidate support and group membership",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

# Stereotyping moderator w/ candidate {.tabset .tabset-fade .tabset-pills}

## Results

```{r n per participant voting group}
stereo_analysis %>% 
  select(subid, par_cand) %>% 
  unique() %>% 
  group_by(par_cand) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(total = sum(n),
         percent = (n/total)*100)
```


```{r stereo analysis by cand}
is_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = stereo_analysis)

tab_model(is_cand,
          title = "Projection moderated by stereotyping")
```


When we include who the participant voted for with stereotyping as well, we still have the main effect from above. Now, the interaction between target group and in-group identification is significant. There is also an interaction between target group (in or out) and who the participant voted for. However, an interaction between target group, degree of in-group identification, and who they voted for is not significant. There are other significant interactions including stereotyping, but, since we only included it as a moderator to see if the relationship persisted, I didn't go through them thoroughly.

## Plot: Projection by group x cand

```{r is group by cand set-up}
is_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:par_cand", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = is_cand)

is_group_cand <- as.data.frame(is_group_cand)

is_group_cand$Group <- as.factor(is_group_cand$inoutgroup_effects)
```

```{r is group by cand plot}
ggplot(is_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  facet_wrap(~par_cand)+
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```   


Clinton supporters counter project and Trump supporters do not. I've checked this a lot and it seems to be correct, I must have messed up in my first year when I analyzed it...

## Plot: Projection by target x ident

```{r stereo cand 3way set-up}
is_3way_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_cand)

is_3way_cand <- as.data.frame(is_3way_cand)

is_3way_cand$Group <- as.factor(is_3way_cand$inoutgroup_effects)
is_3way_cand$Identification <- as.factor(is_3way_cand$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r three-way stereo cand}
ggplot(is_3way_cand, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Plot: Projection x group

```{r main effect group plot set-up cand, include = FALSE}
is_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_cand)

is_group_cand <- as.data.frame(is_group_cand)

is_group_cand$Group <- as.factor(is_group_cand$inoutgroup_effects)
```

```{r main effect group plot BW cand}
ggplot(is_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Plot: Stereotyping by group

```{r stereo inout}
is_group_stereo <- effect(term = "MFQStereo_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_cand)

is_group_stereo <- as.data.frame(is_group_stereo)

is_group_stereo$Group <- as.factor(is_group_stereo$inoutgroup_effects)

ggplot(is_group_stereo, aes(MFQStereo_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Stereotyping predicted by group membership",
       subtitle = "Controlling for projection",
       x = "MFQ responses for typical group member",
       y = "MFQ responses for target")
```

People stereotype out-group more than in-group.

## Plot: Stereotyping by cand

```{r stereo voter pref}
is_cand_stereo <- effect(term = "MFQStereo_c:par_cand", 
                             xlevels = list(par_cand = c("Clinton", "Trump")), 
                             mod = is_cand)

is_cand_stereo <- as.data.frame(is_cand_stereo)

is_cand_stereo$Candidate <- as.factor(is_cand_stereo$par_cand)

ggplot(is_cand_stereo, aes(MFQStereo_c, 
                               fit, 
                               group = Candidate, 
                               color = Candidate)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Candidate)) +
  theme_minimal() +
  labs(title = "Stereotyping predicted by voter preference",
       subtitle = "Controlling for projection",
       x = "MFQ responses for typical group member",
       y = "MFQ responses for target")
```

Clinton supporters stereotype more than Trump supporters.

## Plot: Stereotyping by group x cand

```{r is group by cand set-up for stereo}
is_group_cand_stereo <- effect(term = "MFQStereo_c:inoutgroup_effects:par_cand", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = is_cand)

is_group_cand_stereo <- as.data.frame(is_group_cand_stereo)

is_group_cand_stereo$Group <- as.factor(is_group_cand_stereo$inoutgroup_effects)
```

```{r is group by cand for stereo}
ggplot(is_group_cand_stereo, aes(MFQStereo_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  facet_wrap(~par_cand)+
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Stereotyping predicted by group membership",
       subtitle = "Controlling for projection",
       x = "MFQ responses for typical group",
       y = "MFQ responses for target")
```   

Trump supporters stereotype the out-group more than their in-group, while Clinton supporters stereotype them to a similar extent. 

## Plot: Stereotyping by group x ident

```{r stereo cand 3way set-up predicting stereo}
is_3way_cand_stereo <- effect(term = "MFQStereo_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_cand)

is_3way_cand_stereo  <- as.data.frame(is_3way_cand_stereo)

is_3way_cand_stereo$Group <- as.factor(is_3way_cand_stereo$inoutgroup_effects)
is_3way_cand_stereo$Identification <- as.factor(is_3way_cand_stereo$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r three-way stereo cand predicting stereo}
ggplot(is_3way_cand_stereo, aes(MFQStereo_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Stereotyping predicted by in-group identification and group membership",
       subtitle = "Controlling for projection",
       x = "MFQ responses for typical group",
       y = "MFQ responses for target")
```

## Plot: Projection by stereo x group

```{r proj x stereo x inoutgroup set-up}
describe(stereo_analysis$MFQStereo_c)
is_stereo_proj_group <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects", 
                           xlevels = list(MFQStereo_c = c(-1.48, 0, 1.48), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_cand)

is_stereo_proj_group  <- as.data.frame(is_stereo_proj_group)

is_stereo_proj_group$Group <- as.factor(is_stereo_proj_group$inoutgroup_effects)
is_stereo_proj_group$Stereotyping <- as.factor(is_stereo_proj_group$MFQStereo_c)

stereo_label <- c("-1.48" = "Less stereotyping \n (1 SD below)", 
                 "0" = "Average stereotyping",
                 "1.48" = "High stereotyping \n(1 SD above)")
```

```{r proj x stereo x inoutgroup plot}
ggplot(is_stereo_proj_group, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Stereotyping, labeller = 
               labeller(Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by stereotyping and group membership",
       subtitle = "Higher stereotyping = more correspondence between MFQ responses \nfor stereotypical group member and target individual",
       x = "MFQ responses for Self",
       y = "MFQ responses for target")
```

## Plot: Projection by stereo x ident

```{r proj x stereo x identification set-up}
is_stereo_proj_ident <- effect(term = "MFQSelf_c:MFQStereo_c:ident_c", 
                           xlevels = list(MFQStereo_c = c(-1.48, 0, 1.48), 
                                         ident_c = c(-1.78, 0, 1.78)), 
                           mod = is_cand)

is_stereo_proj_ident  <- as.data.frame(is_stereo_proj_ident)

is_stereo_proj_ident$Identification <- as.factor(is_stereo_proj_ident$ident_c)
is_stereo_proj_ident$Stereotyping <- as.factor(is_stereo_proj_ident$MFQStereo_c)

stereo_label <- c("-1.48" = "Less stereotyping \n (1 SD below)", 
                 "0" = "Average stereotyping",
                 "1.48" = "High stereotyping \n(1 SD above)")
```

```{r proj x stereo x ident plot}
ggplot(is_stereo_proj_ident, aes(MFQSelf_c, 
                             fit, 
                             group = Identification, 
                             color = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Identification)) +
  facet_wrap(~Stereotyping, labeller = 
               labeller(Stereotyping = stereo_label)) +
  scale_linetype_manual("Identification", breaks = c(-1.78, 0, 1.78), 
                       labels = c("Low (1 SD below)", 
                                  "Average", 
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "dashed",
                                  "dotted")) +
  theme_minimal() +
  labs(title = "Projection predicted by stereotyping and identification",
       subtitle = "Higher stereotyping = more correspondence between MFQ responses \nfor stereotypical group member and target individual",
       x = "MFQ responses for Self",
       y = "MFQ responses for target")
```

##Plot: Projection by stereo x group x ident

```{r proj x stereo x identification x group set-up}
is_stereo_proj_ident_group <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects:ident_c", 
                           xlevels = list(MFQStereo_c = c(-1.48, 0, 1.48), 
                                         ident_c = c(-1.78, 0, 1.78),
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_cand)

is_stereo_proj_ident_group  <- as.data.frame(is_stereo_proj_ident_group)

is_stereo_proj_ident_group$Identification <- as.factor(is_stereo_proj_ident_group$ident_c)
is_stereo_proj_ident_group$Stereotyping <- as.factor(is_stereo_proj_ident_group$MFQStereo_c)
is_stereo_proj_ident_group$Group <- as.factor(is_stereo_proj_ident_group$inoutgroup_effects)

stereo_label <- c("-1.48" = "Less stereotyping \n (1 SD below)", 
                 "0" = "Average stereotyping",
                 "1.48" = "High stereotyping \n(1 SD above)")
```

```{r proj x stereo x ident x group plot}
ggplot(is_stereo_proj_ident_group, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
    scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by stereotyping, identification, and group",
       subtitle = "Higher stereotyping = more correspondence between MFQ responses \nfor stereotypical group member and target individual",
       x = "MFQ responses for Self",
       y = "MFQ responses for target")
```

## Plot: Projection x stereo x ident x cand

```{r proj x stereo x identification x cand set-up}
is_stereo_proj_ident_cand <- effect(term = "MFQSelf_c:MFQStereo_c:ident_c:par_cand", 
                           xlevels = list(MFQStereo_c = c(-1.48, 0, 1.48), 
                                         ident_c = c(-1.78, 0, 1.78),
                                         par_cand = c("Clinton", "Trump")), 
                           mod = is_cand)

is_stereo_proj_ident_cand  <- as.data.frame(is_stereo_proj_ident_cand)

is_stereo_proj_ident_cand$Identification <- as.factor(is_stereo_proj_ident_cand$ident_c)
is_stereo_proj_ident_cand$Stereotyping <- as.factor(is_stereo_proj_ident_cand$MFQStereo_c)
is_stereo_proj_ident_cand$Candidate <- as.factor(is_stereo_proj_ident_cand$par_cand)

stereo_label <- c("-1.48" = "Less stereotyping \n (1 SD below)", 
                 "0" = "Average stereotyping",
                 "1.48" = "High stereotyping \n(1 SD above)")
```

```{r proj x stereo x ident x cand plot}
ggplot(is_stereo_proj_ident_cand, aes(MFQSelf_c, 
                             fit, 
                             group = Candidate, 
                             color = Candidate)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Candidate)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
    scale_linetype_manual("Candidate", breaks = c("Clinton", "Trump"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by stereotyping, identification, and candidate",
       subtitle = "Higher stereotyping = more correspondence between MFQ responses \nfor stereotypical group member and target individual",
       x = "MFQ responses for Self",
       y = "MFQ responses for target")
```

## Plot: Projection by stereo x group x cand

```{r proj x stereo x inout x cand set-up}
is_stereo_proj_inout_cand <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects:par_cand", 
                           xlevels = list(MFQStereo_c = c(-1.48, 0, 1.48), 
                                         inoutgroup_effects = c(-.5,.5),
                                         par_cand = c("Clinton", "Trump")), 
                           mod = is_cand)

is_stereo_proj_inout_cand  <- as.data.frame(is_stereo_proj_inout_cand)

is_stereo_proj_inout_cand$Group <- as.factor(is_stereo_proj_inout_cand$inoutgroup_effects)
is_stereo_proj_inout_cand$Stereotyping <- as.factor(is_stereo_proj_inout_cand$MFQStereo_c)
is_stereo_proj_inout_cand$Candidate <- as.factor(is_stereo_proj_inout_cand$par_cand)

stereo_label <- c("-1.48" = "Less stereotyping \n (1 SD below)", 
                 "0" = "Average stereotyping",
                 "1.48" = "High stereotyping \n(1 SD above)")
group_label <- c("-0.5" = "Out-group",
                 "0.5" = "In-group")
```

```{r proj x stereo x inout x cand plot}
ggplot(is_stereo_proj_inout_cand, aes(MFQSelf_c, 
                             fit, 
                             group = Candidate, 
                             color = Candidate)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Candidate)) +
  facet_grid(Stereotyping ~ Group, labeller = 
               labeller(Group = group_label, Stereotyping = stereo_label)) +
    scale_linetype_manual("Candidate", breaks = c("Clinton", "Trump"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by stereotyping, identification, and candidate",
       subtitle = "Higher stereotyping = more correspondence between MFQ responses \nfor stereotypical group member and target individual",
       x = "MFQ responses for Self",
       y = "MFQ responses for target")
```

## Plot: Projection by stereo x group x ident x cand

```{r 5way}
is_5way <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects:ident_c:par_cand", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5),
                                         MFQStereo_c = c(-1.48, 0, 1.48),
                                         par_cand = c("Clinton", "Trump")), 
                           mod = is_cand)

is_5way <- as.data.frame(is_5way)

is_5way$Group <- as.factor(is_5way$inoutgroup_effects)
is_5way$Identification <- as.factor(is_5way$ident_c)
is_5way$Stereotyping <- as.factor(is_5way$MFQStereo_c)
is_5way$Candidate <- as.factor(is_5way$par_cand)

#Plot for Clinton supporters - decided to do two two-ways because I think It will be cleaner?

clinton_5way <- is_5way %>% 
  filter(Candidate == "Clinton")

stereo_label <- c("-1.48" = "Low Stereotyping \n (1 SD below)", 
                 "0" = "Average \nStereotyping",
                 "1.48" = "High Stereotyping \n(1 SD above)")

ggplot(clinton_5way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_bw() +
  labs(title = "Projection for Clinton supporters",
       subtitle = "Predicted by identification, target group, and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

#Plot for trump supporters

trump_5way <- is_5way %>% 
  filter(Candidate != "Clinton")

stereo_label <- c("-1.48" = "Low Stereotyping \n (1 SD below)", 
                 "0" = "Average \nStereotyping",
                 "1.48" = "High Stereotyping \n(1 SD above)")

ggplot(trump_5way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_bw() +
  labs(title = "Projection for Trump supporters",
       subtitle = "Predicted by identification, target group, and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

# Diff score analysis between nomothetic and idiographic stereo {.tabset .tabset-fade .tabset-pills}

## Results

```{r getting nomothetic stereotypes}
nom_v_id_data <- stereo_analysis %>% 
  group_by(MFQ_Number, par_cand, inoutgroup_effects) %>% 
  mutate(stereo_nomothetic = mean(MFQStereo)) %>% 
  ungroup() %>% 
  group_by(subid) %>% 
  mutate(stereo_diff = abs(MFQStereo - stereo_nomothetic))

nom_v_id_model <- lmer(MFQTarg ~ MFQSelf_c * stereo_diff *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = nom_v_id_data)

tab_model(nom_v_id_model,
          title = "Nomothetic/idiographic difference score predicting projection")
```

## Plots

```{r proj by diff int set-up}
nvi_projxdiff <- effect(term = "MFQSelf_c:stereo_diff", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0)), 
                             mod = nom_v_id_model)

nvi_projxdiff <- as.data.frame(nvi_projxdiff)

nvi_projxdiff$stereo_diff <- as.factor(nvi_projxdiff$stereo_diff)
```

```{r proj vy diff int plot}
ggplot(nvi_projxdiff, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  scale_linetype_manual("Stereoype Difference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```

Non-significant main effect of stereotype difference.


```{r proj by cand only}
ggplot(nom_v_id_data, aes(MFQSelf_c, MFQTarg, color = par_cand)) +
  geom_smooth(method = "lm",
              se = TRUE) +
  theme_minimal() +
  scale_color_viridis_d() +
  theme(legend.title=element_blank()) +
  labs(title = "Projection predicted by candidate",
       subtitle = "Model including stereotyping difference as moderator",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

```

Trump supporters project more than Clinton supporters, but neither counter project across moderators.

```{r proj by cand by diff}
nvi_projxdiffxcand <- effect(term = 
                                "MFQSelf_c:stereo_diff:par_cand", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = nom_v_id_model)

nvi_projxdiffxcand<- as.data.frame(nvi_projxdiffxcand)

nvi_projxdiffxcand$stereo_diff <- as.factor(nvi_projxdiffxcand$stereo_diff)
nvi_projxdiffxcand$cand <- as.factor(nvi_projxdiffxcand$par_cand)

ggplot(nvi_projxdiffxcand, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_wrap(~par_cand) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score and \ncandidate preference",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))

```

As stereotype difference increases, projection decreases for Clinton supporters. On the other hand, as stereoype difference increases, projection increases for Trump supporters.

```{r proj x diff x group set-up}
nvi_projxdiffxgroup <- effect(term = "MFQSelf_c:stereo_diff:inoutgroup_effects", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            inoutgroup_effects = c(-0.5, 0.5)), 
                             mod = nom_v_id_model)

nvi_projxdiffxgroup<- as.data.frame(nvi_projxdiffxgroup)

nvi_projxdiffxgroup$stereo_diff <- as.factor(nvi_projxdiffxgroup$stereo_diff)
nvi_projxdiffxgroup$group <- as.factor(nvi_projxdiffxgroup$inoutgroup_effects)

group_label = c("-0.5" = "Out-group",
                "0.5" = "In-group")
```


```{r proj x diff x group int plot}
ggplot(nvi_projxdiffxgroup, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_wrap(~group, labeller = labeller(group = group_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score and target group",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```

Non-significant interaction, but wanted to show it. Regardless of stereotype difference, people are counter projecting with their out-group target and projecting with their in-group.

```{r proj, stereo diff, ident set-up}
nvi_projxdiffxident <- effect(term = "MFQSelf_c:stereo_diff:ident_c", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            ident_c = c(-1.78, 0, 1.78)), 
                             mod = nom_v_id_model)

nvi_projxdiffxident <- as.data.frame(nvi_projxdiffxident)

nvi_projxdiffxident$stereo_diff <- as.factor(nvi_projxdiffxident$stereo_diff)
nvi_projxdiffxident$Identification <- as.factor(nvi_projxdiffxident$ident_c)
```

```{r proj x diff x ident int plot}
ggplot(nvi_projxdiffxident, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score and identification",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```


As in-group identification increases, people whose individual stereotypes are the same as their group stereotype project less. Interestingly, those who show even a slight difference between stereotypes, continue to project the same amount across in-group identification. Moreover, people whose stereotypes are 2 or more different from the group stereotype's intercepts increase as identification increases.

```{r proj x diff x group x cand set-up}
nvi_projxdiffxgroupxcand <- effect(term = 
                                "MFQSelf_c:stereo_diff:inoutgroup_effects:par_cand", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            inoutgroup_effects = c(-0.5, 0.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = nom_v_id_model)

nvi_projxdiffxgroupxcand<- as.data.frame(nvi_projxdiffxgroupxcand)

nvi_projxdiffxgroupxcand$stereo_diff <- as.factor(nvi_projxdiffxgroupxcand$stereo_diff)
nvi_projxdiffxgroupxcand$group <- as.factor(nvi_projxdiffxgroupxcand$inoutgroup_effects)
nvi_projxdiffxgroupxcand$cand <- as.factor(nvi_projxdiffxgroupxcand$par_cand)
```


```{r proj x diff x group x cand int plot}
ggplot(nvi_projxdiffxgroupxcand, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_grid(group~cand, labeller = labeller(group = group_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score, \ntarget group, and voter preference",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```

Clinton supporters counter project with their out-group regardless of stereotype difference, while Trump supporters either don't project (at high stereotype difference) to slightly project (as stereotypes become more like the group stereotype). With in-group targets, Clinton supporters project more similarly across stereotype difference, though people whose stereotype's of their in-group are most similar to the group project the most and those who are the most different project the least. On the other hand, Trump supporters project the least with their in-group when they report the same stereotypes as the group and their projection increases as their stereotype difference increases.

# MFQ sub areas {.tabset .tabset-fade .tabset-pills}

```{r mfq subscales}
#separating MFQ into binding and individualizing subscales
mfq_binding <- clean_data2 %>% 
  filter(MFQ_Number %in% c("3", "4", "5", "9", "10", "11", "14", "15", "16", 
                           "19", "20", "21", "25", "26", "27", "30", "31", "32")) %>%
  select(subid, MFQ_Number, MFQTarg, MFQSelf_c, MFQSelf, MFQStereo_c, MFQStereo, inoutgroup_effects, ident_c, par_cand, Liking, WilltoDiscuss, Valid, Treatment, Contentious) %>% 
  unique() %>% 
  na.omit()

mfq_individual <- clean_data2 %>% 
  filter(MFQ_Number %in% c("1", "2", "7", "8", "12", "13", "17", "18", "23", 
                           "24", "28", "29")) %>%
  select(subid, MFQ_Number, MFQTarg, MFQSelf_c, MFQSelf, MFQStereo_c, MFQStereo, inoutgroup_effects, ident_c, par_cand, Liking, WilltoDiscuss, Valid, Treatment, Contentious) %>% 
  unique() %>% 
  na.omit()
```

## Binding

```{r mfq binding model}
#model
is_mfqbinding <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = mfq_binding)

#results
tab_model(is_mfqbinding,
          title = "Projection moderated by stereotyping for binding morals")
```

```{r 3 way mfq binding set up}
is_binding_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_mfqbinding)

is_binding_3way <- as.data.frame(is_binding_3way)

is_binding_3way$Group <- as.factor(is_binding_3way$inoutgroup_effects)
is_binding_3way$Identification <- as.factor(is_binding_3way$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r 3way mfq binding plot}
ggplot(is_binding_3way, aes(MFQSelf_c,
                             fit, 
                             group = Group,
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection of binding morals predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r binding main effectgroup plot set-up, include = FALSE}
is_binding_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqbinding)

is_binding_group <- as.data.frame(is_binding_group)

is_binding_group$Group <- as.factor(is_binding_group$inoutgroup_effects)
```

```{r binding main effect group plot BW}
ggplot(is_binding_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of binding morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Binding including participant vote

```{r mfq binding model cand}
is_mfqbinding_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = mfq_binding)

tab_model(is_mfqbinding_cand,
          title = "Projection moderated by stereotyping for binding morals")
```


Main effect of target group is still significant. Who participants voted for is marginal (.050). The interaction between target group and identification is still significant. The interaction between target group, identification, and who they voted for is not significant.


```{r binding group by cand set-up}
bind_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:par_cand", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = is_mfqbinding_cand)

bind_group_cand <- as.data.frame(bind_group_cand)

bind_group_cand$Group <- as.factor(bind_group_cand$inoutgroup_effects)
```

```{r binding group by cand plot}
ggplot(bind_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  facet_wrap(~par_cand)+
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
``` 

## Individualizing

```{r mfq individual model}
is_mfqindividual <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = mfq_individual)

tab_model(is_mfqindividual,
          title = "Projection moderated by stereotyping for individualizing morals")
```


The main effect of target group is still significant. The interaction between target group and identification is no longer significant, but I plotted it just to show the difference.


```{r 3 way mfq individual set up}
describe(mfq_individual$ident_c)

is_indiv_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_mfqindividual)

is_indiv_3way <- as.data.frame(is_indiv_3way)

is_indiv_3way$Group <- as.factor(is_indiv_3way$inoutgroup_effects)
is_indiv_3way$Identification <- as.factor(is_indiv_3way$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")

```

```{r 3way mfq individual plot}
ggplot(is_indiv_3way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r individual main effectgroup plot set-up, include = FALSE}
# getting the information for the main effect of group
is_indiv_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqindividual)

is_indiv_group <- as.data.frame(is_indiv_group)

is_indiv_group$Group <- as.factor(is_indiv_group$inoutgroup_effects)
```

```{r indiv main effect group plot BW}
ggplot(is_indiv_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Individualizing including participant vote

```{r mfq individual model cand}
#model
is_mfqindividual_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = mfq_individual)

#results
tab_model(is_mfqindividual_cand,
          title = "Projection moderated by stereotyping for individual morals")
```


Main effect of target group is still significant. The main effect of who participants voted for is marginal (.077). The interactions between target group and identification  between target group and who participants voted for, and target group, identification, and who participants voted for are all not significant.


```{r individual main effectgroup plot set-up with cand, include = FALSE}
is_indiv_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqindividual_cand)

is_indiv_group_cand <- as.data.frame(is_indiv_group_cand)

is_indiv_group_cand$Group <- as.factor(is_indiv_group_cand$inoutgroup_effects)
```

```{r indivi main effect group plot with cand}
ggplot(is_indiv_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

# Demographic differences in counter projection {.tabset .tabset-fade .tabset-pills}

## Race

```{r stereo analysis with race}
dem_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, par_cand, Race) %>%
  unique() %>% 
  na.omit()

projmodel_stereo_race <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * Race +
                                    (MFQSelf_c|subid), 
                                 data = dem_analysis)

tab_model(projmodel_stereo_race,
          title = "Projection moderated by stereotyping and race")
```


Model is rank deficient, not enough power to check if results differ by race. Could possibly do white vs minorities, but that doesn't feel telling enough.


## Gender

```{r stereo analysis with gender}
gender_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, par_cand, Gender) %>%
  unique() %>% 
  na.omit()

projmodel_stereo_gender <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * Gender +
                                    (MFQSelf_c|subid), 
                                 data = gender_analysis)

tab_model(projmodel_stereo_gender,
          title = "Projection moderated by stereotyping and gender")
```


Gender does not moderate the results.


