---
title: "Initial study - Additional Analyses"
author: "Kathryn Denning"
date: "6/18/2020"
output: 
  html_document:
    code_folding: "hide"
    toc: true
    toc_float: true
    dev: png
  pdf_document:
    dev: cairo_pdf
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
---
```{r set-up, include = FALSE}
#loading packages
library(foreign)
library(reshape2)
library(tidyverse)
library(dplyr)
library(car)
library(haven)
library(psych)
library(lmerTest)
library(sjPlot)
library(reshape2)
library(data.table)
library(emmeans)
library(effects)
library(Cairo)
library(tinytex)
library(rio)

#making it round to three decimal places
options(scipen = 999)
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

knitr::opts_knit$set(dev.args = list(type = "cairo"))

trace(grDevices:::png, quote({
  if (missing(type) && missing(antialias)) {
    type <- "cairo-png"
    antialias <- "subpixel"
  }
}), print = FALSE)
```

```{r data import and cleaning initial study, include = FALSE}
#importing data with IP address and lat/long to look for MTurk bots
bot_check <- Import("ppt1_with lat long to check bots.csv") 

bot_check <- bot_check[-c(1,2),,drop = F] 

#importing the data that has been reviewed for completion of PT task
wide_data <- Import("ppt1_fulldata_ptcleanedonly.xlsx") 

#dropping the longer description of each question
wide_dropped1 <- wide_data[-c(1),,drop = F] 

#removing repeat IP addresses since those often indicate bots
#getting a dataset with only subid and IPAdress
ip <- bot_check %>% 
  select(subid, IPAddress)

#identifying the repeat IP addresses
repeat_ips <- ip$IPAddress[duplicated(ip$IPAddress)]

#getting the corresponding subids
bot_check %>% 
  select(subid, IPAddress, LocationLatitude, LocationLongitude) %>% 
  filter(IPAddress %in% c("24.241.223.182", "72.79.119.56", "108.230.124.237", "172.97.7.163", "67.236.228.7", "68.190.36.43"))

#removing the subids from the overall dataset that has already been cleaned to remove people who did not correctly complete the PT narrative task
no_bots <- wide_data %>% 
  filter(!subid %in% c(96, 99, 166, 167, 171, 239, 265, 345, 613, 758, 778, 779))

no_bots <- no_bots[-c(1), ] 
#Data cleaning
clean_data <- no_bots %>% 
  ## drop two MFQ items that aren't actually the survey - 6, 22 in each
select(-MFQSelf_6, -MFQSelf_22, -MFQTrump_6, -MFQTrump_22, -MFQClin_6,
       -MFQClin_22, -MFQTarg_6, -MFQTarg_22) %>% 
  ## dropping PANAS and exploratory items for this study to make data more manageable
  select(-c(PANAS1_1:PANAS1_20, PANAS2_1:PANAS2_20, 
            gender_writein, race_writein, birth_writein, race_writein, 
            language_writein, raise_writein)) %>% 
  mutate_if(is.factor, as.numeric) %>% 
  ### Wrangling data to get MFQ for self, MFQ to targ, MFQ for stereotype, column for candidate, average of IG identification
  gather("MFQ_Type", "MFQ_Score", MFQSelf_1:MFQTarg_32) %>% 
  separate(.,MFQ_Type, c("MFQ_Type", "MFQ_Number"),"\\_") %>% 
  spread(MFQ_Type, MFQ_Score) %>% 
  gather("IG_Type", "IG_Score", IG_Clin_1:IG_Trump_14) %>% 
  separate(.,IG_Type, c("Drop", "IG_Type", "IG_Number"),"\\_") %>% 
  filter(!is.na(IG_Score)) %>% 
  group_by(subid) %>% 
  #average of in-group identification for each subject
  #making candidate they voted for a factor
  mutate(Cand_votedfor = ifelse(IG_Type == "Clin", 1, 
                                ifelse(IG_Type == "Trump", 0, NA))) %>% 
  gather("Day_key", "Day_content", Day_Clin_In_PT:Day_Trump_In_C) %>% 
  mutate(Day_key = as.factor(Day_key)) %>% 
  filter(!is.na(Day_content)) %>% 
  mutate(inoutgroup = fct_collapse(Day_key, 
                                   Ingroup = c("Day_Clin_In_C", 
                                                "Day_Clin_In_PT", 
                                                "Day_Trump_In_C", 
                                                "Day_Trump_In_PT"), 
                                   Outgroup = c("Day_Clin_Out_C", 
                                                "Day_Clin_Out_PT",
                                                "Day_Trump_Out_C", 
                                                "Day_Trump_Out_PT")),
         PT = fct_collapse(Day_key,
                           PT = c("Day_Clin_In_PT",
                                  "Day_Trump_In_PT",
                                  "Day_Clin_Out_PT",
                                  "Day_Trump_Out_PT"),
                           control = c("Day_Clin_In_C",
                                       "Day_Trump_In_C",
                                       "Day_Clin_Out_C",
                                       "Day_Trump_Out_C")),
         par_cand = fct_collapse(Day_key,
                                  Clinton = c("Day_Clin_In_PT",
                                           "Day_Clin_Out_PT",
                                           "Day_Clin_In_C",
                                           "Day_Clin_Out_C"),
                                  Trump = c("Day_Trump_In_PT",
                                            "Day_Trump_Out_PT",
                                            "Day_Trump_In_C",
                                            "Day_Trump_Out_C")),
         targ_cand = fct_collapse(Day_key,
                                  Clinton = c("Day_Clin_In_PT",
                                              "Day_Clin_In_C",
                                              "Day_Trump_Out_PT",
                                              "Day_Trump_Out_C"),
                                  Trump = c("Day_Clin_Out_PT",
                                            "Day_Clin_Out_C",
                                            "Day_Trump_In_PT",
                                            "Day_Trump_In_C")))

clean_data[,1:31] <- sapply(clean_data[,1:31],as.numeric)
clean_data[,34:36] <- sapply(clean_data[,34:36],as.numeric)

clean_data2 <- clean_data %>%
  mutate(IG_ave = mean(IG_Score)) %>% 
  filter(!is.na(IG_ave)) %>% 
  select(-Drop) %>% 
  #effects coding for group with ingroup = .5 and outgorup = -.5, for PT .5 = PT and Control = -.5
  mutate(inoutgroup_effects = ifelse(inoutgroup == "Ingroup", .5,
                                     ifelse(inoutgroup == "Outgroup", -.5, NA)),
         PT_effects = ifelse(PT == "PT", .5, 
                             ifelse(PT == "control", -.5, NA)),
         targ_cand = ifelse(targ_cand == "Clinton", 1, 
                            ifelse(targ_cand == "Trump", 2, NA)),
         MFQStereo = ifelse(par_cand == "Clinton", MFQClin, 
                            ifelse(par_cand == "Trump", MFQTrump, NA))) %>% 
  #grand mean centering MFQ for self
  mutate(MFQSelf_c = MFQSelf - mean(MFQSelf)) %>%  
  #removing people who failed the manipulation check
  filter(targ_cand == 1 & Man_TargVote == 1 | 
           targ_cand == 2 & Man_TargVote == 2) %>%
  select(-Day_content, -Day_key) %>% 
  #effects coding candidate
  mutate(Targ_Cand_effectscoded = ifelse(targ_cand == "1", .5, 
                                         ifelse(targ_cand == "2", -.5, NA)),
         MFQStereo_c = MFQStereo - mean(MFQStereo, na.rm = TRUE))

#for some reason, this wouldn't work in the piping above, so had to hard code it
#grand mean centering for ingroup identification
clean_data2$ident_c <- clean_data2$IG_ave - mean(clean_data2$IG_ave, na.rm = TRUE)
clean_data2$Gender <- as.factor(clean_data2$Gender)
levels(clean_data2$Gender) <- c("Male", "Female", "Other")
clean_data2$Race <- as.factor(clean_data2$Race)
levels(clean_data2$Race) <- c("American Indian/Native Alaskan", 
                             "Asian", 
                             "Black",
                             "Latinx",
                             "Middle Eastern",
                             "Caucasian",
                             "Multiracial",
                             "Other")

#data with just the variables for analysis for stereotyping
stereo_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, Man_PT, par_cand, MFQStereo) %>%
  unique() %>% 
  na.omit()
```

# Stereotype moderator analysis

```{r stereo analysis}
#model
projmodel_stereo <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = stereo_analysis)

#results
tab_model(projmodel_stereo,
          title = "Projection moderated by stereotyping")
```

## Plots for overall model

```{r int proj, stereo, and ident set-up}
proj_stereo_effects <- effect(term = "MFQSelf_c:MFQStereo_c:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         MFQStereo_c = c(-1.35, 0, 1.35)), 
                           mod = projmodel_stereo)

proj_stereo_int <- as.data.frame(proj_stereo_effects)

proj_stereo_int$Stereotyping <- as.factor(proj_stereo_int$MFQStereo_c)
proj_stereo_int$Identification <- as.factor(proj_stereo_int$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r proj stereo ident plot}
ggplot(proj_stereo_int, aes(MFQSelf_c, 
                             fit, 
                             group = Stereotyping, 
                             color = Stereotyping)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Stereotyping)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Stereotyping", breaks = c(-1.35, 0, 1.35), 
                       labels = c("Low (1 SD below)", 
                                  "Average",
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "dashed",
                                  "dotted")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```


```{r three-way stereo set-up}
initial_study_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = projmodel_stereo)

initial_study_3way <- as.data.frame(initial_study_3way)

initial_study_3way$Group <- as.factor(initial_study_3way$inoutgroup_effects)
initial_study_3way$Identification <- as.factor(initial_study_3way$ident_c)
```

```{r three-way plot BW}
ggplot(initial_study_3way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r main effect group plot set-up, include = FALSE}
initial_study_main_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = projmodel_stereo)

initial_study_main_group <- as.data.frame(initial_study_main_group)

initial_study_main_group$Group <- as.factor(initial_study_main_group$inoutgroup_effects)
```

```{r main effect group plot BW}
ggplot(initial_study_main_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```


These results demonstrate that our significant three-way interaction from before is no longer significant, but the main effect of group identification still is significant and still shows counter projection. The three-way is not significant because, regardless of in-group identification, people are still counter projecting to the same extent with their out-group and projecting normally with their in-group.

## Looking at subgroups of target group

```{r outgroup sig from zero}
out_only <- stereo_analysis %>% filter(inoutgroup_effects != .5)

projmodel_stereo_out <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = out_only)


tab_model(projmodel_stereo_out,
          title = "Projection moderated by stereotyping with out-group data only")
```

This analysis was run using only data for the out-group, meaning the main effect of MFQSelf_c now represents the effect of projection for out-group targets only. The effect is not significant, meaning, in the plot with the whole data looking at the main effect of target group (above), that the out-group effect is not different from 0. 

```{r ingroup sig from zero}
in_only <- stereo_analysis %>% filter(inoutgroup_effects == .5)

projmodel_stereo_in <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = in_only)


tab_model(projmodel_stereo_in,
          title = "Projection moderated by stereotyping with in-group data only")
```

## Looking at subsets of candidate support

```{r Clinton only sig from zero}
clinton_only <- stereo_analysis %>% filter(par_cand == "Clinton")

projmodel_stereo_clinton <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = clinton_only)


tab_model(projmodel_stereo_clinton,
          title = "Projection moderated by stereotyping with Clinton supporter data only")
```

```{r Trump only sig from zero}
trump_only <- stereo_analysis %>% filter(par_cand == "Trump")

projmodel_stereo_trump <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = trump_only)


tab_model(projmodel_stereo_trump,
          title = "Projection moderated by stereotyping with Trump supporter data only")
```

```{r int proj, stereo set-up}
proj_stereo_only <- effect(term = "MFQSelf_c:MFQStereo_c", 
                           xlevels = list(MFQStereo_c = c(-1.35, 0, 1.35)), 
                           mod = projmodel_stereo)

proj_stereo_only <- as.data.frame(proj_stereo_only)

proj_stereo_only$Stereotyping <- as.factor(proj_stereo_only$MFQStereo_c)
```

# Stereotyping moderator analysis adding participant political affiliation

```{r n per participant voting group}
stereo_analysis %>% 
  select(subid, par_cand) %>% 
  unique() %>% 
  group_by(par_cand) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(total = sum(n),
         percent = (n/total)*100)
```


```{r stereo analysis by cand}
is_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = stereo_analysis)

tab_model(is_cand,
          title = "Projection moderated by stereotyping")

```


When we include who the participant voted for with stereotyping as well, we still have the main effect from above. Now, the interaction between target group and in-group identification is significant. There is also an interaction between target group (in or out) and who the participant voted for. However, an interaction between target group, degree of in-group identification, and who they voted for is not significant. There are other significant interactions including stereotyping, but, since we only included it as a moderator to see if the relationship persisted, I didn't go through them thoroughly.

## Plots

```{r is group by cand set-up}
is_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:par_cand", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = is_cand)

is_group_cand <- as.data.frame(is_group_cand)

is_group_cand$Group <- as.factor(is_group_cand$inoutgroup_effects)
```

```{r is group by cand plot}
ggplot(is_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  facet_wrap(~par_cand)+
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```   


Clinton supporters counter project and Trump supporters do not. I've checked this a lot and it seems to be correct, I must have messed up in my first year when I analyzed it...


```{r stereo cand 3way set-up}
is_3way_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_cand)

is_3way_cand <- as.data.frame(is_3way_cand)

is_3way_cand$Group <- as.factor(is_3way_cand$inoutgroup_effects)
is_3way_cand$Identification <- as.factor(is_3way_cand$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r three-way stereo cand}
ggplot(is_3way_cand, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r main effect group plot set-up cand, include = FALSE}
is_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_cand)

is_group_cand <- as.data.frame(is_group_cand)

is_group_cand$Group <- as.factor(is_group_cand$inoutgroup_effects)
```

```{r main effect group plot BW cand}
ggplot(is_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r 5way}
is_5way <- effect(term = "MFQSelf_c:MFQStereo_c:inoutgroup_effects:ident_c:par_cand", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5),
                                         MFQStereo_c = c(-1.35, 0, 1.35),
                                         par_cand = c("Clinton", "Trump")), 
                           mod = is_cand)

is_5way <- as.data.frame(is_5way)

is_5way$Group <- as.factor(is_5way$inoutgroup_effects)
is_5way$Identification <- as.factor(is_5way$ident_c)
is_5way$Stereotyping <- as.factor(is_5way$MFQStereo_c)
is_5way$Candidate <- as.factor(is_5way$par_cand)

#Plot for Clinton supporters - decided to do two two-ways because I think It will be cleaner?

clinton_5way <- is_5way %>% 
  filter(Candidate == "Clinton")

stereo_label <- c("-1.35" = "Low Stereotyping \n (1 SD below)", 
                 "0" = "Average \nStereotyping",
                 "1.35" = "High Stereotyping \n(1 SD above)")

ggplot(clinton_5way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_bw() +
  labs(title = "Projection for Clinton supporters",
       subtitle = "Predicted by identification, target group, and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")

#Plot for trump supporters

trump_5way <- is_5way %>% 
  filter(Candidate != "Clinton")

stereo_label <- c("-1.35" = "Low Stereotyping \n (1 SD below)", 
                 "0" = "Average \nStereotyping",
                 "1.35" = "High Stereotyping \n(1 SD above)")

ggplot(trump_5way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_grid(Stereotyping ~ Identification, labeller = 
               labeller(Identification = ident_label, Stereotyping = stereo_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_bw() +
  labs(title = "Projection for Trump supporters",
       subtitle = "Predicted by identification, target group, and stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

# Analysis w/ difference score between nomothetic and idiographic stereotyping

```{r getting nomothetic stereotypes}
nom_v_id_data <- stereo_analysis %>% 
  group_by(MFQ_Number, par_cand, inoutgroup_effects) %>% 
  mutate(stereo_nomothetic = mean(MFQStereo)) %>% 
  ungroup() %>% 
  group_by(subid) %>% 
  mutate(stereo_diff = abs(MFQStereo - stereo_nomothetic))

nom_v_id_model <- lmer(MFQTarg ~ MFQSelf_c * stereo_diff *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = nom_v_id_data)

tab_model(nom_v_id_model,
          title = "Nomothetic/idiographic difference score predicting projection")
```

## Plots

```{r proj by diff int set-up}
nvi_projxdiff <- effect(term = "MFQSelf_c:stereo_diff", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0)), 
                             mod = nom_v_id_model)

nvi_projxdiff <- as.data.frame(nvi_projxdiff)

nvi_projxdiff$stereo_diff <- as.factor(nvi_projxdiff$stereo_diff)
```

```{r proj vy diff int plot}
ggplot(nvi_projxdiff, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  scale_linetype_manual("Stereoype Difference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```

As the stereotype difference increases, people are projecting more. When people's idiographic stereotypes are more similar to the nomethetic stereotype, they project less. Its when people's stereotypes are less like the group stereotype that they use more projection. 

**This still generally supports Ames (2004) model of stereotyping, but lets see if it upholds by group and other moderators.**

```{r proj x diff x group set-up}
nvi_projxdiffxgroup <- effect(term = "MFQSelf_c:stereo_diff:inoutgroup_effects", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            inoutgroup_effects = c(-0.5, 0.5)), 
                             mod = nom_v_id_model)

nvi_projxdiffxgroup<- as.data.frame(nvi_projxdiffxgroup)

nvi_projxdiffxgroup$stereo_diff <- as.factor(nvi_projxdiffxgroup$stereo_diff)
nvi_projxdiffxgroup$group <- as.factor(nvi_projxdiffxgroup$inoutgroup_effects)

group_label = c("-0.5" = "Out-group",
                "0.5" = "In-group")
```


```{r proj x diff x group int plot}
ggplot(nvi_projxdiffxgroup, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_wrap(~group, labeller = labeller(group = group_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score and target group",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```

When people in the out-group condition's individual stereotypes become more like the group (less difference), they counter project more. People in the out-group condition project normally regardless of how much their in-group stereotypes are like that of the group.

```{r proj, stereo diff, ident set-up}
nvi_projxdiffxident <- effect(term = "MFQSelf_c:stereo_diff:ident_c", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            ident_c = c(-1.78, 0.0, 1.78)), 
                             mod = nom_v_id_model)

nvi_projxdiffxident <- as.data.frame(nvi_projxdiffxident)

nvi_projxdiffxident$stereo_diff <- as.factor(nvi_projxdiffxident$stereo_diff)
nvi_projxdiffxident$Identification <- as.factor(nvi_projxdiffxident$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0.0" = "Average identification",
                 "1.78" = "High identificatiion \n (1 SD above)")
```

```{r proj x diff x ident int plot}
ggplot(nvi_projxdiffxident, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score and identification",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```


As in-group identification increases, people whose individual stereotypes are the same as their group stereotype project less. Interestingly, those who show even a slight difference between stereotypes, continue to project the same amount across in-group identification. Moreover, people whose stereotypes are 2 or more different from the group stereotype start projecting *more* as in-group identification increase.


```{r proj x diff x group x cand set-up}
nvi_projxdiffxgroupxcand <- effect(term = 
                                "MFQSelf_c:stereo_diff:inoutgroup_effects:par_cand", 
                             xlevels = list(stereo_diff = c(0,1.0,2.0,3.0,4.0),
                                            inoutgroup_effects = c(-0.5, 0.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = nom_v_id_model)

nvi_projxdiffxgroupxcand<- as.data.frame(nvi_projxdiffxgroupxcand)

nvi_projxdiffxgroupxcand$stereo_diff <- as.factor(nvi_projxdiffxgroupxcand$stereo_diff)
nvi_projxdiffxgroupxcand$group <- as.factor(nvi_projxdiffxgroupxcand$inoutgroup_effects)
nvi_projxdiffxgroupxcand$cand <- as.factor(nvi_projxdiffxgroupxcand$par_cand)
```


```{r proj x diff x group x cand int plot}
ggplot(nvi_projxdiffxgroupxcand, aes(MFQSelf_c, 
                               fit, 
                               group = stereo_diff, 
                               color = stereo_diff)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = stereo_diff)) +
  facet_grid(group~cand, labeller = labeller(group = group_label)) +
  scale_linetype_manual("Stereoype \nDifference", breaks = c(0,1.0,2.0,3.0,4.0), 
                       labels = c("None",
                                  "1.0",
                                  "2.0",
                                  "3.0",
                                  "4.0"),
                       values = c("solid", 
                                  "dashed",
                                  "dotted",
                                  "F1",
                                  "1F")) +
  theme_minimal(base_size = 13) +
  labs(title = "Projection predicted by stereotype difference score, \ntarget group, and voter preference",
       subtitle = "Difference score operationalized as nomothetic - idiographic ",
       x = "MFQ responses for self",
       y = "MFQ responses for target") +
  theme(legend.text = element_text(size = 10),
        legend.key.width = unit(1.4, "cm"))
```


Clinton supporters in the out-group condition are the only group to show counter projection. People whose individual stereotypes are more similiar to the group stereotype (either the same or only 1 point of difference), counter project. Out-group Clinton supporters who are 2 points different from the group on stereotypes do not project at all, and those whose stereotypes are very different from the group stereotype continue to project normally onto their out-group.

Trump supporters in the out-group condition whose individual stereotypes are the same as the group stereotype do not project. As the difference between their idiographic and nomothetic stereotypes increases, Trump supporters project more with thier out-group. 

Both groups continue to project with their in-group regardless of stereotype difference.

# MFQ sub areas

```{r mfq subscales}
#separating MFQ into binding and individualizing subscales
mfq_binding <- clean_data2 %>% 
  filter(MFQ_Number %in% c("3", "4", "5", "9", "10", "11", "14", "15", "16", 
                           "19", "20", "21", "25", "26", "27", "30", "31", "32")) %>%
  select(subid, MFQ_Number, MFQTarg, MFQSelf_c, MFQSelf, MFQStereo_c, MFQStereo, inoutgroup_effects, ident_c, par_cand, Liking, WilltoDiscuss, Valid, Treatment, Contentious) %>% 
  unique() %>% 
  na.omit()

mfq_individual <- clean_data2 %>% 
  filter(MFQ_Number %in% c("1", "2", "7", "8", "12", "13", "17", "18", "23", 
                           "24", "28", "29")) %>%
  select(subid, MFQ_Number, MFQTarg, MFQSelf_c, MFQSelf, MFQStereo_c, MFQStereo, inoutgroup_effects, ident_c, par_cand, Liking, WilltoDiscuss, Valid, Treatment, Contentious) %>% 
  unique() %>% 
  na.omit()
```

## Binding

```{r mfq binding model}
#model
is_mfqbinding <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = mfq_binding)

#results
tab_model(is_mfqbinding,
          title = "Projection moderated by stereotyping for binding morals")
```

```{r 3 way mfq binding set up}
is_binding_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_mfqbinding)

is_binding_3way <- as.data.frame(is_binding_3way)

is_binding_3way$Group <- as.factor(is_binding_3way$inoutgroup_effects)
is_binding_3way$Identification <- as.factor(is_binding_3way$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")
```

```{r 3way mfq binding plot}
ggplot(is_binding_3way, aes(MFQSelf_c,
                             fit, 
                             group = Group,
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection of binding morals predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r binding main effectgroup plot set-up, include = FALSE}
is_binding_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqbinding)

is_binding_group <- as.data.frame(is_binding_group)

is_binding_group$Group <- as.factor(is_binding_group$inoutgroup_effects)
```

```{r binding main effect group plot BW}
ggplot(is_binding_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of binding morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Binding including participant vote

```{r mfq binding model cand}
is_mfqbinding_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = mfq_binding)

tab_model(is_mfqbinding_cand,
          title = "Projection moderated by stereotyping for binding morals")
```


Main effect of target group is still significant. Who participants voted for is marginal (.050). The interaction between target group and identification is still significant. The interaction between target group, identification, and who they voted for is not significant.


```{r binding group by cand set-up}
bind_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects:par_cand", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5),
                                            par_cand = c("Clinton", "Trump")), 
                             mod = is_mfqbinding_cand)

bind_group_cand <- as.data.frame(bind_group_cand)

bind_group_cand$Group <- as.factor(bind_group_cand$inoutgroup_effects)
```

```{r binding group by cand plot}
ggplot(bind_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  facet_wrap(~par_cand)+
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
``` 

## Individualizing

```{r mfq individual model}
is_mfqindividual <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c +
                                    (MFQSelf_c|subid), 
                                 data = mfq_individual)

tab_model(is_mfqindividual,
          title = "Projection moderated by stereotyping for individualizing morals")
```


The main effect of target group is still significant. The interaction between target group and identification is no longer significant, but I plotted it just to show the difference.


```{r 3 way mfq individual set up}
describe(mfq_individual$ident_c)

is_indiv_3way <- effect(term = "MFQSelf_c:inoutgroup_effects:ident_c", 
                           xlevels = list(ident_c = c(-1.78, 0, 1.78), 
                                         inoutgroup_effects = c(-.5,.5)), 
                           mod = is_mfqindividual)

is_indiv_3way <- as.data.frame(is_indiv_3way)

is_indiv_3way$Group <- as.factor(is_indiv_3way$inoutgroup_effects)
is_indiv_3way$Identification <- as.factor(is_indiv_3way$ident_c)

ident_label <- c("-1.78" = "Low identification \n (1 SD below)", 
                 "0" = "Average identification",
                 "1.78" = "High identificatiion \n(1 SD above)")

```

```{r 3way mfq individual plot}
ggplot(is_indiv_3way, aes(MFQSelf_c, 
                             fit, 
                             group = Group, 
                             color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black", 
              aes(linetype = Group)) +
  facet_wrap(~Identification, labeller = 
               labeller(Identification = ident_label)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                   "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by in-group identification and group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

```{r individual main effectgroup plot set-up, include = FALSE}
# getting the information for the main effect of group
is_indiv_group <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqindividual)

is_indiv_group <- as.data.frame(is_indiv_group)

is_indiv_group$Group <- as.factor(is_indiv_group$inoutgroup_effects)
```

```{r indiv main effect group plot BW}
ggplot(is_indiv_group, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

## Individualizing including participant vote

```{r mfq individual model cand}
#model
is_mfqindividual_cand <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * par_cand +
                                    (MFQSelf_c|subid), 
                                 data = mfq_individual)

#results
tab_model(is_mfqindividual_cand,
          title = "Projection moderated by stereotyping for individual morals")
```


Main effect of target group is still significant. The main effect of who participants voted for is marginal (.077). The interactions between target group and identification  between target group and who participants voted for, and target group, identification, and who participants voted for are all not significant.


```{r individual main effectgroup plot set-up with cand, include = FALSE}
is_indiv_group_cand <- effect(term = "MFQSelf_c:inoutgroup_effects", 
                             xlevels = list(inoutgroup_effects = c(-.5,.5)), 
                             mod = is_mfqindividual_cand)

is_indiv_group_cand <- as.data.frame(is_indiv_group_cand)

is_indiv_group_cand$Group <- as.factor(is_indiv_group_cand$inoutgroup_effects)
```

```{r indivi main effect group plot with cand}
ggplot(is_indiv_group_cand, aes(MFQSelf_c, 
                               fit, 
                               group = Group, 
                               color = Group)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Group)) +
  scale_linetype_manual("Group", breaks = c(-.5, .5), 
                       labels = c("Out-group", "In-group"),
                       values = c("solid", 
                                  "dashed")) +
  theme_minimal() +
  labs(title = "Projection of individualizing morals predicted by group membership",
       subtitle = "Controlling for stereotyping",
       x = "MFQ responses for self",
       y = "MFQ responses for target")
```

# Demographic differences in counter projection

## Race

```{r stereo analysis with race}
dem_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, par_cand, Race) %>%
  unique() %>% 
  na.omit()

projmodel_stereo_race <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * Race +
                                    (MFQSelf_c|subid), 
                                 data = dem_analysis)

tab_model(projmodel_stereo_race,
          title = "Projection moderated by stereotyping and race")
```


Model is rank deficient, not enough power to check if results differ by race. Could possibly do white vs minorities, but that doesn't feel telling enough.


## Gender

```{r stereo analysis with gender}
gender_analysis <- clean_data2 %>% 
  select(subid, MFQ_Number, MFQSelf_c, MFQStereo_c, MFQTarg, ident_c, PT_effects, 
         inoutgroup_effects, par_cand, Gender) %>%
  unique() %>% 
  na.omit()

projmodel_stereo_gender <- lmer(MFQTarg ~ MFQSelf_c * MFQStereo_c *
                                    inoutgroup_effects * ident_c * Gender +
                                    (MFQSelf_c|subid), 
                                 data = gender_analysis)

tab_model(projmodel_stereo_gender,
          title = "Projection moderated by stereotyping and gender")
```


Gender does not moderate the results.


